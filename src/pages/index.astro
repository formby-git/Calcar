---
import Layout from "../layouts/Layout.astro";
import RegistrationForm from "../components/RegistrationForm.astro";
import VehicleCard from "../components/VehicleCard.astro";
import TCOCalculator from "../components/TCOCalculator.astro";
---

<Layout title="Calcar - Smart Car Ownership">
	<div
		id="landing-background"
		class="fixed inset-0 z-[-1] transition-opacity duration-700 bg-[linear-gradient(to_right,#f0f0f0_1px,transparent_1px),linear-gradient(to_bottom,#f0f0f0_1px,transparent_1px)] bg-[size:4rem_4rem]"
	>
	</div>

	<div
		id="landing-wrapper"
		class="min-h-[80vh] flex flex-col justify-center transition-all duration-700 ease-in-out"
		data-state="initial"
	>
		<!-- Brutalist Hero -->
		<div
			id="hero-content"
			class="mb-16 text-center transition-all duration-500 delay-100 px-4"
		>
			<h1
				class="text-5xl md:text-7xl font-bold tracking-tighter mb-8 text-swiss-black leading-[0.8]"
			>
				TRUE<br />COST.
			</h1>
			<p
				class="text-lg md:text-xl text-swiss-black max-w-md mx-auto font-mono uppercase tracking-wide border-t border-swiss-black pt-6"
			>
				Analysis. Depreciation. Truth.<br />
				The definitive UK car TCO tool.
			</p>
		</div>

		<div
			class="w-full max-w-xl mx-auto transition-transform duration-700 px-4"
		>
			<RegistrationForm />
		</div>
	</div>

	<div
		id="results-container"
		class="opacity-0 translate-y-20 transition-all duration-700 delay-300 hidden"
	>
		<VehicleCard />
		<TCOCalculator />
	</div>
</Layout>

<script>
	const wrapper = document.getElementById("landing-wrapper");
	const background = document.getElementById("landing-background");
	const resultsContainer = document.getElementById("results-container");
	const heroContent = document.getElementById("hero-content");

	// Listen for the custom event from RegistrationForm
	window.addEventListener("car-loaded", () => {
		// Transition state
		wrapper?.setAttribute("data-state", "results");

		// 1. Fade out background
		if (background) {
			background.style.opacity = "0";
			setTimeout(() => {
				background.style.display = "none";
			}, 700);
		}

		// 2. Move wrapper to top
		if (wrapper) {
			wrapper.classList.remove("min-h-[80vh]", "justify-center");
			wrapper.classList.add("mt-8", "mb-8");
		}

		// 3. Fade out hero content slightly or adjust it
		if (heroContent) {
			heroContent.classList.remove("mb-10");
			heroContent.classList.add("mb-6");
		}

		// 4. Show results
		if (resultsContainer) {
			resultsContainer.classList.remove("hidden");
			// Small delay to allow layout to settle before fading in results
			requestAnimationFrame(() => {
				resultsContainer.classList.remove(
					"opacity-0",
					"translate-y-20",
				);
			});
		}
	});
</script>
