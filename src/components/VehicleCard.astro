---

---

<div id="vehicle-card" class="relative hidden mb-8">
  <div
    class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden p-6 md:p-8"
  >
    <!-- Header: Make, Model & Registration -->
    <div
      class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8"
    >
      <div>
        <div class="text-3xl font-extrabold text-slate-900 leading-tight">
          <span id="val-make"></span>
          <span id="val-model" class="text-blue-600"></span>
        </div>
      </div>

      <!-- Registration Plate -->
      <div
        class="bg-[#FCD116] border-2 border-black rounded px-4 py-1 shadow-sm inline-block"
      >
        <span
          id="val-reg"
          class="font-mono text-xl md:text-2xl font-bold text-black tracking-widest uppercase"
        ></span>
      </div>
    </div>

    <div class="grid md:grid-cols-3 gap-8">
      <!-- Col 1: Image (Takes up 2/3) -->
      <div class="md:col-span-2">
        <div
          id="image-wrapper"
          class="bg-slate-100 rounded-lg overflow-hidden hidden"
        >
          <img
            id="vehicle-image"
            class="w-full h-auto object-contain"
            src=""
            alt="Vehicle Preview"
          />
        </div>
        <!-- Fallback/Loading state for image area -->
        <div
          id="image-placeholder"
          class="h-64 md:h-80 bg-slate-50 rounded-lg border-2 border-dashed border-slate-200 flex items-center justify-center"
        >
          <p class="text-slate-400">Loading image...</p>
        </div>
      </div>

      <!-- Col 2: Specs List -->
      <div class="md:col-span-1 flex flex-col justify-center space-y-6">
        <div>
          <p
            class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-1"
          >
            Year
          </p>
          <p class="font-medium text-lg text-slate-700" id="val-year">-</p>
        </div>
        <div class="w-full h-px bg-slate-100"></div>

        <div>
          <p
            class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-1"
          >
            Colour
          </p>
          <p class="font-medium text-lg text-slate-700" id="val-colour">-</p>
        </div>
        <div class="w-full h-px bg-slate-100"></div>

        <div>
          <p
            class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-1"
          >
            Fuel Type
          </p>
          <p class="font-medium text-lg text-slate-700" id="val-fuel">-</p>
        </div>
        <div class="w-full h-px bg-slate-100"></div>

        <div>
          <p
            class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-1"
          >
            CO2 Emissions
          </p>
          <div class="flex items-center gap-2">
            <p class="font-medium text-lg text-slate-700" id="val-co2">-</p>
            <span
              class="text-xs px-2 py-0.5 rounded-full bg-slate-100 text-slate-500 font-mono"
              >g/km</span
            >
          </div>
        </div>
        <div class="w-full h-px bg-slate-100"></div>

        <div>
          <p
            class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-1"
          >
            Original List Price
          </p>
          <p class="font-medium text-lg text-slate-700" id="val-listprice">-</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  import type { Car } from "../utils/carService";
  import { fetchCarImage } from "../utils/wikiImageService";

  const card = document.getElementById("vehicle-card");
  const imageWrapper = document.getElementById("image-wrapper");
  const imagePlaceholder = document.getElementById("image-placeholder");
  const vehicleImage = document.getElementById(
    "vehicle-image",
  ) as HTMLImageElement;

  window.addEventListener("car-loaded", (async (e: CustomEvent<Car>) => {
    const car = e.detail;
    if (!card) return;

    // Update fields
    setText("val-make", car.make + " ");
    setText("val-model", car.model);
    setText("val-reg", car.registration);
    setText("val-fuel", car.fuelType);
    setText("val-year", car.yearOfManufacture.toString());
    setText("val-co2", car.co2Emissions.toString());
    setText("val-colour", car.colour);
    setText(
      "val-listprice",
      new Intl.NumberFormat("en-GB", {
        style: "currency",
        currency: "GBP",
        maximumFractionDigits: 0,
      }).format(car.originalListPrice),
    );

    card.classList.remove("hidden");

    // Reset image state
    if (imageWrapper) imageWrapper.classList.add("hidden");
    if (imagePlaceholder) imagePlaceholder.classList.remove("hidden");

    // Fetch Image
    if (imageWrapper && vehicleImage) {
      const imageUrl = await fetchCarImage(car.make, car.model);
      if (imageUrl) {
        vehicleImage.src = imageUrl;
        if (imagePlaceholder) imagePlaceholder.classList.add("hidden");
        imageWrapper.classList.remove("hidden");
      } else {
        if (imagePlaceholder) {
          const tempP = imagePlaceholder.querySelector("p");
          if (tempP) tempP.textContent = "No image found";
        }
      }
    }
  }) as unknown as EventListener);

  function setText(id: string, text: string) {
    const el = document.getElementById(id);
    if (el) el.textContent = text;
  }
</script>
