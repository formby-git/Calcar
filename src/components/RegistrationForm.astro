---

---

<div class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-slate-200">
  <label for="reg-input" class="block text-sm font-medium text-slate-700 mb-2"
    >Registration Number</label
  >
  <div class="flex gap-2">
    <input
      type="text"
      id="reg-input"
      placeholder="ENTER REG"
      class="flex-1 px-4 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 uppercase tracking-wider font-mono"
      maxlength="8"
      value="ABC1234"
    />
    <button
      id="lookup-btn"
      class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md font-medium transition-colors"
    >
      Lookup
    </button>
  </div>
  <div id="error-msg" class="text-red-500 text-sm mt-2 hidden"></div>

  <div class="mt-4 flex justify-center">
    <button
      id="lucky-btn"
      class="text-blue-600 hover:text-blue-700 text-sm font-medium transition-colors border-b border-transparent hover:border-blue-700"
    >
      I'm Feeling Lucky
    </button>
  </div>
</div>

<script>
  import { getCarByRegistration, getRandomCar } from "../utils/carService";

  const input = document.getElementById("reg-input") as HTMLInputElement;
  const btn = document.getElementById("lookup-btn");
  const luckyBtn = document.getElementById("lucky-btn");
  const errorMsg = document.getElementById("error-msg");

  const loadCar = (car: any) => {
    if (car) {
      window.dispatchEvent(new CustomEvent("car-loaded", { detail: car }));
    }
  };

  btn?.addEventListener("click", async () => {
    const reg = input.value.trim().toUpperCase();
    if (!reg) return;

    // Validation: Alphanumeric and spaces only
    const regPattern = /^[A-Z0-9 ]+$/;
    if (!regPattern.test(reg)) {
      if (errorMsg) {
        errorMsg.textContent =
          "Invalid registration format (Alphanumeric only)";
        errorMsg.classList.remove("hidden");
      }
      return;
    }

    if (btn) btn.textContent = "Loading...";
    if (errorMsg) errorMsg.classList.add("hidden");

    try {
      const car = await getCarByRegistration(reg);
      if (car) {
        loadCar(car);
      } else {
        if (errorMsg) {
          errorMsg.textContent = "Vehicle not found";
          errorMsg.classList.remove("hidden");
        }
      }
    } catch (e) {
      if (errorMsg) {
        errorMsg.textContent = "Error fetching details";
        errorMsg.classList.remove("hidden");
      }
    } finally {
      if (btn) btn.textContent = "Lookup";
    }
  });

  luckyBtn?.addEventListener("click", async () => {
    if (luckyBtn) luckyBtn.textContent = "Finding...";
    if (errorMsg) errorMsg.classList.add("hidden");

    try {
      const car = await getRandomCar();
      loadCar(car);
    } catch (e) {
      if (errorMsg) {
        errorMsg.textContent = "Error picking random car";
        errorMsg.classList.remove("hidden");
      }
    } finally {
      if (luckyBtn) luckyBtn.textContent = "I'm Feeling Lucky";
    }
  });
</script>
