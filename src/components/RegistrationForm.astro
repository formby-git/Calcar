---

---

<div
  class="bg-swiss-white p-5 md:p-6 border border-swiss-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]"
>
  <label
    for="reg-input"
    class="block text-sm font-bold font-grotesk uppercase tracking-widest text-swiss-black mb-4 flex items-center gap-2"
  >
    <div class="w-3 h-3 bg-swiss-blue"></div>
    Input Registration
  </label>

  <div class="flex flex-col md:flex-row gap-0 border border-swiss-black">
    <input
      type="text"
      id="reg-input"
      placeholder="ENTER REG"
      class="flex-1 px-4 py-3 bg-white text-xl font-mono text-swiss-black placeholder:text-gray-400 focus:outline-none focus:bg-swiss-blue/5 uppercase tracking-wider rounded-none"
      maxlength="8"
      value="ABC1234"
    />
    <button
      id="lookup-btn"
      class="bg-swiss-black hover:bg-swiss-blue text-white px-6 py-3 font-mono font-bold uppercase tracking-wider text-sm transition-colors duration-200 border-l-0 md:border-l border-t md:border-t-0 border-swiss-black flex items-center justify-center gap-2 rounded-none"
    >
      <span>Analyze</span>
      <span>→</span>
    </button>
  </div>
  <div
    id="error-msg"
    class="text-white bg-red-600 font-mono text-sm mt-4 p-2 hidden border border-swiss-black"
  >
  </div>

  <div
    class="mt-6 flex justify-between items-center bg-gray-50 border border-gray-200 p-2"
  >
    <p class="text-sm text-gray-700 font-sans tracking-tight">System Ready</p>
    <button
      id="lucky-btn"
      class="text-swiss-black hover:text-swiss-blue hover:underline text-sm font-bold tracking-wider font-sans"
    >
      [Feeling Lucky?]
    </button>
  </div>
</div>

<script>
  import { getCarByRegistration, getRandomCar } from "../utils/carService";

  const input = document.getElementById("reg-input") as HTMLInputElement;
  const btn = document.getElementById("lookup-btn");
  const luckyBtn = document.getElementById("lucky-btn");
  const errorMsg = document.getElementById("error-msg");

  const loadCar = (car: any) => {
    if (car) {
      window.dispatchEvent(new CustomEvent("car-loaded", { detail: car }));
    }
  };

  btn?.addEventListener("click", async () => {
    const reg = input.value.trim().toUpperCase();
    if (!reg) return;

    // Validation: Alphanumeric and spaces only
    const regPattern = /^[A-Z0-9 ]+$/;
    if (!regPattern.test(reg)) {
      if (errorMsg) {
        errorMsg.textContent =
          "Invalid registration format (Alphanumeric only)";
        errorMsg.classList.remove("hidden");
      }
      return;
    }

    if (btn) btn.textContent = "Loading...";
    if (errorMsg) errorMsg.classList.add("hidden");

    try {
      const car = await getCarByRegistration(reg);
      if (car) {
        loadCar(car);
      } else {
        if (errorMsg) {
          errorMsg.textContent = "Vehicle not found";
          errorMsg.classList.remove("hidden");
        }
      }
    } catch (e) {
      if (errorMsg) {
        errorMsg.textContent = "Error fetching details";
        errorMsg.classList.remove("hidden");
      }
    } finally {
      if (btn) btn.innerHTML = "<span>Analyze</span><span>→</span>";
    }
  });

  luckyBtn?.addEventListener("click", async () => {
    if (luckyBtn) luckyBtn.textContent = "Finding...";
    if (errorMsg) errorMsg.classList.add("hidden");

    try {
      const car = await getRandomCar();
      loadCar(car);
    } catch (e) {
      if (errorMsg) {
        errorMsg.textContent = "Error picking random car";
        errorMsg.classList.remove("hidden");
      }
    } finally {
      if (luckyBtn) luckyBtn.textContent = "[Feeling Lucky?]";
    }
  });
</script>
